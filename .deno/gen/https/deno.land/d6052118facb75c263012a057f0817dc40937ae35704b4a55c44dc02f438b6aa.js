import { OAuth2GrantBase } from "./grant_base.ts";
import { ResourceResponseError } from "./errors.ts";
export class ResourceGrant extends OAuth2GrantBase {
    constructor(client){
        super(client);
    }
    async serverResponse(method, resourcePath, token, requestOptions) {
        const headers = {
            "Authorization": `Bearer ${token}`,
            "content-type": "application/json"
        };
        const resourceUrl = resourcePath.startsWith('https://') ? resourcePath : this.client.config.resourceEndpointHost + resourcePath;
        const request = this.buildRequest(resourceUrl, {
            method,
            headers
        }, requestOptions);
        const response = await fetch(request);
        if (!response.ok) {
            console.log(new ResourceResponseError(`{ status: ${response.status}, statusText: ${response.statusText}, url: ${resourceUrl}, method: ${method}, tokenLength: ${token.length} }`, response));
        }
        return response;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvb2F1dGgyQHYwLjIuNi9zcmMvcmVzb3VyY2VfZ3JhbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBPQXV0aDJDbGllbnQgfSBmcm9tIFwiLi9vYXV0aDJfY2xpZW50LnRzXCI7XG5pbXBvcnQgeyBPQXV0aDJHcmFudEJhc2UgfSBmcm9tIFwiLi9ncmFudF9iYXNlLnRzXCI7XG5pbXBvcnQgeyBIdHRwVmVyYiwgUmVxdWVzdE9wdGlvbnMgfSBmcm9tIFwiLi90eXBlcy50c1wiO1xuaW1wb3J0IHsgUmVzb3VyY2VSZXNwb25zZUVycm9yIH0gZnJvbSBcIi4vZXJyb3JzLnRzXCI7XG5cbmV4cG9ydCBjbGFzcyBSZXNvdXJjZUdyYW50IGV4dGVuZHMgT0F1dGgyR3JhbnRCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcihjbGllbnQ6IE9BdXRoMkNsaWVudCkge1xuICAgICAgICBzdXBlcihjbGllbnQpO1xuICAgICAgfTtcblxuICAgIHB1YmxpYyBhc3luYyBzZXJ2ZXJSZXNwb25zZShcbiAgICBtZXRob2Q6IEh0dHBWZXJiLFxuICAgIHJlc291cmNlUGF0aDogc3RyaW5nLFxuICAgIHRva2VuOiBzdHJpbmcsXG4gICAgcmVxdWVzdE9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9ucykge1xuICAgICAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgICAgICAgICAgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc291cmNlVXJsOiBzdHJpbmcgPSAocmVzb3VyY2VQYXRoLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpID8gXG4gICAgICAgICAgICByZXNvdXJjZVBhdGggOiBcbiAgICAgICAgICAgIHRoaXMuY2xpZW50LmNvbmZpZy5yZXNvdXJjZUVuZHBvaW50SG9zdCArIHJlc291cmNlUGF0aDtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KHJlc291cmNlVXJsLCB7XG4gICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgIH0sIHJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChyZXF1ZXN0KTtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgY29uc29sZS5sb2cobmV3IFJlc291cmNlUmVzcG9uc2VFcnJvcihgeyBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfSwgc3RhdHVzVGV4dDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fSwgdXJsOiAke3Jlc291cmNlVXJsfSwgbWV0aG9kOiAke21ldGhvZH0sIHRva2VuTGVuZ3RoOiAke3Rva2VuLmxlbmd0aH0gfWAsIHJlc3BvbnNlKSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG59Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVMsZUFBZSxRQUFRLGlCQUFpQixDQUFDO0FBRWxELFNBQVMscUJBQXFCLFFBQVEsYUFBYSxDQUFDO0FBRXBELE9BQU8sTUFBTSxhQUFhLFNBQVMsZUFBZTtJQUM5QyxZQUFZLE1BQW9CLENBQUU7UUFDOUIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ2Y7SUFFSCxNQUFhLGNBQWMsQ0FDM0IsTUFBZ0IsRUFDaEIsWUFBb0IsRUFDcEIsS0FBYSxFQUNiLGNBQStCLEVBQUU7UUFDN0IsTUFBTSxPQUFPLEdBQTJCO1lBQ3BDLGVBQWUsRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNsQyxjQUFjLEVBQUUsa0JBQWtCO1NBQ3JDLEFBQUM7UUFDRixNQUFNLFdBQVcsR0FBVyxBQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEdBQzVELFlBQVksR0FDWixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsR0FBRyxZQUFZLEFBQUM7UUFDM0QsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUU7WUFDM0MsTUFBTTtZQUNOLE9BQU87U0FDVixFQUFFLGNBQWMsQ0FBQyxBQUFDO1FBQ25CLE1BQU0sUUFBUSxHQUFHLE1BQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxBQUFDO1FBQ3RDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFO1lBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLHFCQUFxQixDQUFDLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLGVBQWUsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQy9MO1FBQ0QsT0FBTyxRQUFRLENBQUE7S0FDbEI7Q0FDSiJ9