import { oauth2Client, getUserProfile } from 'services/oauth.ts';
import { setSession } from 'repositories/session_repository.ts';
export const handler = {
    async GET (req) {
        const uuid = crypto.randomUUID();
        let oauthResponse = await oauth2Client.code.getToken(req.url);
        let profile = await getUserProfile(oauthResponse.accessToken);
        let user = await setSession(profile.sub, oauthResponse);
        return new Response(JSON.stringify({
            ...oauthResponse
        }), {
            headers: {
                "Content-Type": "application/json"
            }
        });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vaG9tZS9ydW5uZXIvU29GcmVzaFNvQ2xlYW4vcm91dGVzL2FwaS9vYXV0aC9jYWxsYmFjay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYW5kbGVycyB9IGZyb20gXCIkZnJlc2gvc2VydmVyLnRzXCI7XG5pbXBvcnQgeyBvYXV0aDJDbGllbnQsIGdldFVzZXJQcm9maWxlIH0gZnJvbSAnc2VydmljZXMvb2F1dGgudHMnXG5pbXBvcnQgeyBzZXRTZXNzaW9uIH0gZnJvbSAncmVwb3NpdG9yaWVzL3Nlc3Npb25fcmVwb3NpdG9yeS50cyc7XG5pbXBvcnQgKiBhcyBjb29raWUgZnJvbSBcImNvb2tpZVwiO1xuXG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyOiBIYW5kbGVycyA9IHtcbiAgYXN5bmMgR0VUKHJlcSkge1xuICAgIGNvbnN0IHV1aWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuICAgIGxldCBvYXV0aFJlc3BvbnNlID0gYXdhaXQgb2F1dGgyQ2xpZW50LmNvZGUuZ2V0VG9rZW4ocmVxLnVybCk7XG4gICAgbGV0IHByb2ZpbGUgPSBhd2FpdCBnZXRVc2VyUHJvZmlsZShvYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuKTtcbiAgICBsZXQgdXNlciA9IGF3YWl0IHNldFNlc3Npb24ocHJvZmlsZS5zdWIsIG9hdXRoUmVzcG9uc2UpO1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyAuLi5vYXV0aFJlc3BvbnNlIH0pLCB7XG4gICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXG4gICAgfSk7XG4gIH0sXG59O1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVMsWUFBWSxFQUFFLGNBQWMsUUFBUSxtQkFBbUIsQ0FBQTtBQUNoRSxTQUFTLFVBQVUsUUFBUSxvQ0FBb0MsQ0FBQztBQUloRSxPQUFPLE1BQU0sT0FBTyxHQUFhO0lBQy9CLE1BQU0sR0FBRyxFQUFDLEdBQUcsRUFBRTtRQUNiLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQUFBQztRQUNqQyxJQUFJLGFBQWEsR0FBRyxNQUFNLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQUFBQztRQUM5RCxJQUFJLE9BQU8sR0FBRyxNQUFNLGNBQWMsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLEFBQUM7UUFDOUQsSUFBSSxJQUFJLEdBQUcsTUFBTSxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUMsQUFBQztRQUN4RCxPQUFPLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7WUFBRSxHQUFHLGFBQWE7U0FBRSxDQUFDLEVBQUU7WUFDeEQsT0FBTyxFQUFFO2dCQUFFLGNBQWMsRUFBRSxrQkFBa0I7YUFBRTtTQUNoRCxDQUFDLENBQUM7S0FDSjtDQUNGLENBQUMifQ==